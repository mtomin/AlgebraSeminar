@using System.IdentityModel.Tokens.Jwt

@{
    Layout = "~/Views/Shared/_Layout.cshtml";

    if (Request.Cookies["auth_token"] == null)
    {
        Session["TrenutniZaposlenik"] = null;
    }
    else
    {

        {
            var handler = new JwtSecurityTokenHandler();
            var token = handler.ReadToken(Request.Cookies["auth_token"].Value) as JwtSecurityToken;
            if (token.ValidTo > DateTime.UtcNow)
            {
                Session["TrenutniZaposlenik"] = token.Claims.Single(claim => claim.Type == "given_name").Value;
            }
            else
            {
                Session["TrenutniZaposlenik"] = null;
            }

        }
    }
}